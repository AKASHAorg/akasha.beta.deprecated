{"version":3,"file":"request-aeth.js","sourceRoot":"","sources":["request-aeth.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,OAAO,MAAM,UAAU,CAAC;AACpC,OAAO,EAAE,IAAI,IAAI,IAAI,EAAE,MAAM,YAAY,CAAC;AAC1C,OAAO,EAAE,aAAa,EAAE,WAAW,EAAE,gBAAgB,EAAE,MAAM,aAAa,CAAC;AAE3E,MAAM,CAAC,OAAO,UAAU,IAAI,CAAE,EAAE,EAAE,UAAU;IAC1C,MAAM,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,EAAE;QACnD,MAAM,UAAU,GAAG,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC;QACvF,MAAM,YAAY,GAAG,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;QAC3F,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,YAAY,CAAC,UAAU,GAAG;YACvD,OAAO,IAAI,CAAC,UAAU,CAAC;iBACpB,GAAG,CAAC,cAAc,EAAE,kBAAkB,CAAC;iBACvC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,CAAC;iBACpD,GAAG,CAAC,GAAG,CAAC,CAAC;QACd,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAS,EAAE,EAAE;YACpB,IAAI,IAAI,CAAC,EAAE,IAAI,IAAI,CAAC,IAAI,EAAE;gBACxB,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aAC9B;YACD,OAAO,IAAI,CAAC;QACd,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;YAChB,MAAM,IAAI,KAAK,CAAC,qCAAqC,CAAC,CAAC;SACxD;QAED,UAAU,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC;aACnD,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;QAC1D,OAAO,QAAQ,CAAC;IAElB,CAAC,CAAC,CAAC;IAEH,MAAM,YAAY,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,cAAc,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC;IACxE,MAAM,OAAO,GAAG;QACd,OAAO,YAAY,CAAC;IACtB,CAAC,CAAC;IACF,EAAE,EAAE,CAAC,OAAO,CAAC,aAAa,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC;IAClD,OAAO,YAAY,CAAC;AACtB,CAAC","sourcesContent":["import * as Promise from 'bluebird';\nimport { post as POST } from 'superagent';\nimport { COMMON_MODULE, CORE_MODULE, GENERAL_SETTINGS } from './constants';\n\nexport default function init (sp, getService) {\n  const execute = Promise.coroutine(function* (data, cb) {\n    const FAUCET_URL = (getService(CORE_MODULE.SETTINGS)).get(GENERAL_SETTINGS.FAUCET_URL);\n    const FAUCET_TOKEN = (getService(CORE_MODULE.SETTINGS)).get(GENERAL_SETTINGS.FAUCET_TOKEN);\n    const response = yield Promise.fromCallback(function (cb1) {\n      return POST(FAUCET_URL)\n        .set('Content-Type', 'application/json')\n        .send({ address: data.address, token: FAUCET_TOKEN })\n        .end(cb1);\n    }).then((body: any) => {\n      if (body.ok && body.text) {\n        return JSON.parse(body.text);\n      }\n      return body;\n    });\n\n    if (!response.tx) {\n      throw new Error('The request could not be completed.');\n    }\n    // @Todo: replace this with a simple version\n    getService(CORE_MODULE.CONTRACTS).watchTx(response.tx)\n      .then(success => cb('', success)).catch(err => cb(err));\n    return response;\n\n  });\n\n  const requestEther = { execute, name: 'requestEther', hasStream: true };\n  const service = function () {\n    return requestEther;\n  };\n  sp().service(COMMON_MODULE.requestEther, service);\n  return requestEther;\n}\n"]}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/ipc/logger.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/ipc/logger.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
const { ipcMain } = require('electron');
const Logger = require('../../loggers');
const { EVENTS } = require('../settings');

const symbolEnforcer = Symbol();
const symbol = Symbol();

class LoggerService {
    /*
     * This is called from the getInstance function.
     * It shouldn't be called from any other place with new LoggerService
     * @param {Symbol} enforcer
     * @returns {LoggerService}
     */
    constructor (enforcer) {
        if (enforcer !== symbolEnforcer) {
            throw new Error('Cannot construct singleton');
        }
        this.loggerNames = ['geth', 'ipfs'];
        this.PREVIOUS_LOG_LINES = -10;
        this.serverEvent = EVENTS.server.logger;
        this.clientEvent = EVENTS.client.logger;
    }
    /**
     * Makes sure it returns the same reference to a GethAction instance
     * This must be used in order to get a GethAction instance
     * @returns {GethAction}
     */
    static getInstance () {
        if (!this[symbol]) {
            this[symbol] = new LoggerService(symbolEnforcer);
        }
        return this[symbol];
    }
    /**
    * Shorthand function for sending events back to the View layer
    * @param event
    */
    _sendEvent (event) {
        return (name, successCode, data) => {
            event.sender.send(name, {
                success: successCode,
                status: data
            });
        };
    }
    /*
     * It sets up the listeners for this module.
     *
     * @param {BrowserWindow} mainWindow
     * @returns undefined
     */
    setupListeners (mainWindow) {
        ipcMain.on(this.serverEvent.gethInfo, (event, arg) => {
            this._getGethInfo(event, arg);
        });
        ipcMain.on(this.serverEvent.stopGethInfo, (event, arg) => {
            this._stopGethInfo(event, arg);
        });
    }
    /**
    * Shorthand function for getting the AkashaLogger instance
    * @returns {AkashaLogger}
    */
    _getGlobalLogger () {
        return Logger.getInstance();
    }
    /**
    * Shorthand function for getting a winston.Logger instance
    * @returns {winston.Logger}
    */
    _getLog (name) {
        return this._getGlobalLogger().getLogger(name);
    }
    /**
    * This function queries the GETH Logger for the last this.PREVIOUS_LOG_LINES entries
    * and sends them back to the view layer.
    * If arg is boolean true, it keeps sending entries to the client. If the client wants
    * to stop receiving entries it has to send this.serverEvent.stopGethInfo message.
    * @param event, arg
    * @returns undefined
    */
    _getGethInfo (event, arg) {
        if (this._getLog('geth')) {
            this._getLog('geth').query({
                start: this.PREVIOUS_LOG_LINES
            }, (err, data) => {
                if (!err) {
                    this._sendEvent(event)(this.clientEvent.gethInfo, true, data);
                } else {
                    this._sendEvent(event)(this.clientEvent.gethInfo, false, err);
                }
            });
            if (arg === true) {
                this._getLog('geth').on('logging', this._sendGethUpdates(event));
            }
        }
    }
    /**
    * This function is called every time the client wants to be updated with GETH new log entries.
    * It returns a function that gets called every time a new entry is logged by AkashaLogger.
    * @param event
    * @returns {Function}
    */
    _sendGethUpdates (event) {
        this.__gethUpdatesHandler = (transport, level, msg, meta) => {
            this._sendEvent(event)(this.clientEvent.gethInfo, true, {
                'log-get': { status: msg }
            });
        };
        return this.__gethUpdatesHandler;
    }
    /**
    * This function is called when the client is not interested any more in the GETH updates
    * @param event, arg
    * @returns undefined
    */
    _stopGethInfo (event, arg) {
        this._getLog('geth').removeListener('logging', this.__gethUpdatesHandler);
    }

}

export default LoggerService;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AkashaLogger.html">AkashaLogger</a></li><li><a href="GethConnector.html">GethConnector</a></li><li><a href="GethService.html">GethService</a></li><li><a href="IpfsConnector.html">IpfsConnector</a></li><li><a href="IpfsService.html">IpfsService</a></li><li><a href="ProfileClass.html">ProfileClass</a></li><li><a href="TransactionsClass.html">TransactionsClass</a></li><li><a href="UserPreferences.html">UserPreferences</a></li><li><a href="Web3.html">Web3</a></li></ul><h3>Global</h3><ul><li><a href="global.html#checkProfileHash">checkProfileHash</a></li><li><a href="global.html#createProfileFolder">createProfileFolder</a></li><li><a href="global.html#getLocalProfiles">getLocalProfiles</a></li><li><a href="global.html#manifest">manifest</a></li><li><a href="global.html#signString">signString</a></li><li><a href="global.html#uploadProfile">uploadProfile</a></li><li><a href="global.html#watchTx">watchTx</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jun 08 2016 10:06:54 GMT+0300 (EEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>

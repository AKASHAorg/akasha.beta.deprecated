<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/services/geth/web3.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/services/geth/web3.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Web3Factory from 'web3';
import Promise from 'bluebird';

class Web3 {

    /**
     * @param admin
     * @param miner
     */
    constructor ({ admin = true, miner = false } = {}) {

        this.adminInit = false;
        this.minerInit = false;

        this._web3 = new Web3Factory();
        this._web3.net = Promise.promisifyAll(this._web3.net);
        this._web3.shh = Promise.promisifyAll(this._web3.shh);
        this._web3.eth = Promise.promisifyAll(this._web3.eth);
        this._web3.personal = Promise.promisifyAll(this._web3.personal);

        if (admin) {
            this.initAdmin();
        }

        if (miner) {
            this.initMiner();
        }

    }

    get web3 () {
        return this._web3;
    }

    initAdmin () {
        const { methods, properties } = this._adminMethods();

        if (this.adminInit) {
            return;
        }
        this._web3._extend({
            property: 'admin',
            methods,
            properties
        });

        this._web3.admin = Promise.promisifyAll(this._web3.admin);
        this.adminInit = true;
    }

    initMiner () {
        const { methods, properties } = this._minerMethods();
        if (this.minerInit) {
            return;
        }
        this._web3._extend({
            property: 'miner',
            methods,
            properties
        });

        this._web3.miner = Promise.promisifyAll(this._web3.miner);
        this.minerInit = true;
    }

    setProvider (gethIpc, socket) {
        if (!this._web3.currentProvider) {
            this._web3.setProvider(new this._web3.providers.IpcProvider(gethIpc, socket));
            this._web3.eth.getCoinbase((err, coinbase) => {
                if (err) {
                    console.warn(err);
                } else if (coinbase) {
                    this._web3.eth.defaultAccount = coinbase;
                }
            });
        }
    }

    _adminMethods () {
        return {
            methods: [
                new this._web3._extend.Method({
                    name: 'addPeer',
                    call: 'admin_addPeer',
                    params: 1,
                    inputFormatter: [this._web3._extend.utils.fromDecimal],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                }),

                new this._web3._extend.Method({
                    name: 'exportChain',
                    call: 'admin_exportChain',
                    params: 1,
                    inputFormatter: [null],
                    outputFormatter: (obj) => obj
                }),

                new this._web3._extend.Method({
                    name: 'importChain',
                    call: 'admin_importChain',
                    params: 1,
                    inputFormatter: [null],
                    outputFormatter: (obj) => obj
                }),

                new this._web3._extend.Method({
                    name: 'verbosity',
                    call: 'admin_verbosity',
                    params: 1,
                    inputFormatter: [this._web3._extend.utils.formatInputInt],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                }),

                new this._web3._extend.Method({
                    name: 'setSolc',
                    call: 'admin_setSolc',
                    params: 1,
                    inputFormatter: [null],
                    outputFormatter: this._web3._extend.formatters.formatOutputString
                }),

                new this._web3._extend.Method({
                    name: 'startRPC',
                    call: 'admin_startRPC',
                    params: 4,
                    inputFormatter: [null, this._web3._extend.utils.formatInputInteger, null, null],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                }),

                new this._web3._extend.Method({
                    name: 'stopRPC',
                    call: 'admin_stopRPC',
                    params: 0,
                    inputFormatter: [],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                })
            ],
            properties: [
                new this._web3._extend.Property({
                    name: 'nodeInfo',
                    getter: 'admin_nodeInfo',
                    outputFormatter: this._web3._extend.formatters.formatOutputString
                }),

                new this._web3._extend.Property({
                    name: 'peers',
                    getter: 'admin_peers',
                    outputFormatter: (obj) => obj
                }),

                new this._web3._extend.Property({
                    name: 'datadir',
                    getter: 'admin_datadir',
                    outputFormatter: this._web3._extend.formatters.formatOutputString
                }),

                new this._web3._extend.Property({
                    name: 'chainSyncStatus',
                    getter: 'admin_chainSyncStatus',
                    outputFormatter: (obj) => obj
                })
            ]
        };
    }

    _minerMethods () {
        return {
            methods: [
                new this._web3._extend.Method({
                    name: 'start',
                    call: 'miner_start',
                    params: 1,
                    inputFormatter: [this._web3._extend.formatters.formatInputInt],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                }),

                new this._web3._extend.Method({
                    name: 'stop',
                    call: 'miner_stop',
                    params: 1,
                    inputFormatter: [this._web3._extend.formatters.formatInputInt],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                }),

                new this._web3._extend.Method({
                    name: 'setExtra',
                    call: 'miner_setExtra',
                    params: 1,
                    inputFormatter: [this._web3._extend.utils.formatInputString],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                }),

                new this._web3._extend.Method({
                    name: 'setGasPrice',
                    call: 'miner_setGasPrice',
                    params: 1,
                    inputFormatter: [this._web3._extend.utils.formatInputString],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                }),

                new this._web3._extend.Method({
                    name: 'startAutoDAG',
                    call: 'miner_startAutoDAG',
                    params: 0,
                    inputFormatter: [],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                }),

                new this._web3._extend.Method({
                    name: 'stopAutoDAG',
                    call: 'miner_stopAutoDAG',
                    params: 0,
                    inputFormatter: [],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                }),

                new this._web3._extend.Method({
                    name: 'makeDAG',
                    call: 'miner_makeDAG',
                    params: 1,
                    inputFormatter: [this._web3._extend.formatters.inputDefaultBlockNumberFormatter],
                    outputFormatter: this._web3._extend.formatters.formatOutputBool
                })
            ],

            properties: [
                new this._web3._extend.Property({
                    name: 'hashrate',
                    getter: 'miner_hashrate',
                    outputFormatter: this._web3._extend.utils.toDecimal
                })
            ]
        };
    }
}

export default Web3;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AkashaLogger.html">AkashaLogger</a></li><li><a href="GethConnector.html">GethConnector</a></li><li><a href="GethService.html">GethService</a></li><li><a href="IpfsConnector.html">IpfsConnector</a></li><li><a href="IpfsService.html">IpfsService</a></li><li><a href="ProfileClass.html">ProfileClass</a></li><li><a href="TransactionsClass.html">TransactionsClass</a></li><li><a href="UserPreferences.html">UserPreferences</a></li><li><a href="Web3.html">Web3</a></li></ul><h3>Global</h3><ul><li><a href="global.html#checkProfileHash">checkProfileHash</a></li><li><a href="global.html#createProfileFolder">createProfileFolder</a></li><li><a href="global.html#getLocalProfiles">getLocalProfiles</a></li><li><a href="global.html#manifest">manifest</a></li><li><a href="global.html#signString">signString</a></li><li><a href="global.html#uploadProfile">uploadProfile</a></li><li><a href="global.html#watchTx">watchTx</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jun 08 2016 10:06:54 GMT+0300 (EEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>

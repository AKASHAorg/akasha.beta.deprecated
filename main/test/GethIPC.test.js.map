{"version":3,"file":"GethIPC.test.js","sourceRoot":"","sources":["GethIPC.test.ts"],"names":[],"mappings":"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","sourcesContent":["import GethIPC from '../lib/ipc/GethIPC';\nimport { ipcMain } from 'electron';\nimport { fireEvent, initLogger } from './helpers';\nimport { expect } from 'chai';\nimport channel from '../lib/channels';\n\nclass GethIPCtest extends GethIPC {\n    public callTest: Map<string, any> = new Map();\n\n    public fireEvent(channel, data, event) {\n        const cb = this.callTest.get(channel);\n        return cb(fireEvent(channel, data, event));\n    }\n}\n\ndescribe('GethIPC', function () {\n    this.timeout(60000);\n    let gethChannel: GethIPCtest;\n\n    before(function (done) {\n        expect(initLogger()).to.exist;\n        setTimeout(done, 200);\n    });\n\n    it('--constructs channel api', function () {\n        gethChannel = new GethIPCtest();\n        expect(gethChannel).to.exist;\n    });\n\n    it('--can init listeneres', function () {\n        gethChannel.initListeners(null);\n        expect(gethChannel.listeners.size).to.be.above(0);\n    });\n\n    it('--should add to listened channels', function (done) {\n        let listenersNr = 0;\n        const listenOn = [\n            channel.server.geth.syncStatus,\n            channel.server.geth.logs\n        ];\n        gethChannel.callTest.set(\n            channel.client.geth.manager,\n            (injected) => {\n                listenersNr++;\n                if(listenersNr === listenOn.length){\n                    done()\n                }\n            }\n        );\n        listenOn.forEach((channelName) => {\n            ipcMain.emit(channel.server.geth.manager, '', {channel: channelName, listen: true});\n        });\n    });\n\n    it('--should #startService', function (done) {\n        gethChannel.callTest.set(channel.client.geth.startService, (injected) => {\n            expect(injected.data).to.exist;\n            expect(injected.data.error).to.not.exist;\n            if (injected.data.data.started) {\n                done();\n            }\n        });\n        ipcMain.emit(channel.server.geth.startService, {});\n    });\n\n    it.skip('--should get #syncStatus', function (done) {\n        gethChannel.callTest.set(channel.client.geth.syncStatus, (injected) => {\n            expect(injected.data).to.exist;\n            expect(injected.data.data.synced).to.exist;\n            done();\n        });\n    });\n\n    after(function (done) {\n        gethChannel.callTest.set(channel.client.geth.stopService, (data) => {\n            expect(data.data).to.exist;\n            gethChannel.callTest.clear();\n            done();\n        });\n        ipcMain.emit(channel.server.geth.stopService);\n    });\n\n});\n"]}
{"version":3,"file":"mention.js","sourceRoot":"","sources":["mention.ts"],"names":[],"mappings":";;AAAA,oCAAoC;AACpC,kEAA8D;AAC9D,iEAAyD;AACzD,uCAA+C;AAC/C,oDAAmF;AACnF,iCAA6B;AAE7B,MAAM,OAAO,GAAG,OAAO,CAAC,SAAS,CAC7B,WAAU,IAAgE;IACtE,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,EAAE,CAAC,CAAC,CAAC;QAC3B,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;IAChD,CAAC;IAED,EAAE,CAAC,CAAC,CAAC,sBAAe,CAAC,IAAI,CAAC,CAAC,CAAC;QACxB,sBAAe,CAAC,IAAI,GAAG,MAAM,8BAAa,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;IACzF,CAAC;IACD,MAAM,OAAO,GAAG,YAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACnC,MAAM,WAAW,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,uBAAY,CAAC,OAAO,GAAG,uBAAY,CAAC,KAAK,CAAC;IACjF,MAAM,IAAI,GAAG,MAAM,yBAAc,CAAC,OAAO,EAAE,CAAC;IAE5C,MAAM,OAAO,GAAG,8BAAa,CAAC,WAAW,EAAE,CAAC,IAAI;SAC3C,QAAQ,CACL,IAAI,CAAC,SAAS,CAAC;QACX,OAAO,EAAE,OAAO;QAChB,QAAQ,EAAE,IAAI,CAAC,QAAQ;QACvB,WAAW,EAAE,WAAW;QACxB,OAAO,EAAE,IAAI,CAAC,OAAO;QACrB,SAAS,EAAE,IAAI,CAAC,SAAS;KAC5B,CAAC,CAAC,CAAC;IAEZ,MAAM,IAAI,GAAG,MAAM,8BAAa,CAAC,WAAW,EAAE,CAAC,IAAI;SAC9C,GAAG;SACH,SAAS,CAAC;QACP,IAAI,EAAE,sBAAe,CAAC,IAAI;QAC1B,MAAM,EAAE,CAAC,0BAAe,CAAC;QACzB,OAAO,EAAE,OAAO;QAChB,GAAG,EAAE,sBAAW;KACnB,CAAC,CAAC;IACP,MAAM,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;AAC7B,CAAC,CAAC,CAAC;AAEP,kBAAe,EAAE,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC","sourcesContent":["import * as Promise from 'bluebird';\nimport { GethConnector } from '@akashaproject/geth-connector';\nimport currentProfile from '../registry/current-profile';\nimport { whisperIdentity } from '../chat/post';\nimport { MENTION_CHANNEL, MENTION_TTL, MENTION_TYPE } from '../../config/settings';\nimport { uniq } from 'ramda';\n\nconst execute = Promise.coroutine(\n    function*(data: { mention: string[], entryId: string, commentId?: string }) {\n        if (data.mention.length > 10) {\n            throw new Error('Can mention max 10 users');\n        }\n\n        if (!whisperIdentity.from) {\n            whisperIdentity.from = yield GethConnector.getInstance().web3.shh.newIdentityAsync();\n        }\n        const mention = uniq(data.mention);\n        const mentionType = (data.commentId) ? MENTION_TYPE.COMMENT : MENTION_TYPE.ENTRY;\n        const from = yield currentProfile.execute();\n\n        const payload = GethConnector.getInstance().web3\n            .fromUtf8(\n                JSON.stringify({\n                    mention: mention,\n                    akashaId: from.akashaId,\n                    mentionType: mentionType,\n                    entryId: data.entryId,\n                    commentId: data.commentId\n                }));\n\n        const post = yield GethConnector.getInstance().web3\n            .shh\n            .postAsync({\n                from: whisperIdentity.from,\n                topics: [MENTION_CHANNEL],\n                payload: payload,\n                ttl: MENTION_TTL\n            });\n        return { post, mention };\n    });\n\nexport default { execute, name: 'mention' };\n"]}
{"version":3,"file":"AuthIPC.js","sourceRoot":"","sources":["AuthIPC.ts"],"names":[],"mappings":"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","sourcesContent":["/// <reference path=\"../../typings/main.d.ts\" />\nimport ModuleEmitter from './event/ModuleEmitter';\nimport channels from '../channels';\nimport WebContents = Electron.WebContents;\nimport IpcMainEvent = Electron.IpcMainEvent;\nimport { mainResponse } from './event/responses';\nimport {module as userModule} from './modules/user/index';\nimport {constructed} from './contracts/index';\n\nclass AuthIPC extends ModuleEmitter {\n    constructor() {\n        super();\n        this.MODULE_NAME = 'auth';\n        this.DEFAULT_MANAGED = ['login', 'logout'];\n    }\n\n    initListeners(webContents: WebContents) {\n        this.webContents = webContents;\n        this._login()\n            ._logout()\n            ._generateEthKey()\n            ._getLocalIdentities()\n            ._manager();\n    }\n\n    private _login() {\n        this.registerListener(\n            channels.server[this.MODULE_NAME].login,\n            (event: any, data: AuthLoginRequest) => {\n                userModule\n                    .auth\n                    .login(data.account, data.password, data.rememberTime)\n                    .then((response: any) => {\n                        return this.fireEvent(\n                            channels.client[this.MODULE_NAME].login,\n                            mainResponse(response),\n                            event\n                        );\n                    });\n            });\n        return this;\n    }\n\n    private _logout() {\n        this.registerListener(\n            channels.server[this.MODULE_NAME].logout,\n            (event: any, data: AuthLogoutRequest) => {\n                userModule\n                    .auth\n                    .logout();\n                return this.fireEvent(\n                    channels.client[this.MODULE_NAME].logout,\n                    mainResponse({done: true}),\n                    event\n                );\n            }\n        );\n        return this;\n    }\n\n    private _generateEthKey() {\n        this.registerListener(\n            channels.server[this.MODULE_NAME].generateEthKey,\n            (event: any, data: AuthKeygenRequest) => {\n                userModule\n                    .auth\n                    .generateKey(data.password)\n                    .then((address: string) => {\n                       this.fireEvent(\n                           channels.client[this.MODULE_NAME].generateEthKey,\n                           mainResponse({address})\n                       );\n                    })\n                    .catch((err: Error) => {\n                        this.fireEvent(\n                            channels.client[this.MODULE_NAME].generateEthKey,\n                            mainResponse({error: {message: err.message}})\n                        );\n                    });\n            }\n        );\n        return this;\n    }\n\n    private _getLocalIdentities() {\n        this.registerListener(\n            channels.server[this.MODULE_NAME].getLocalIdentities,\n            (event: any, data: any) => {\n                constructed\n                    .instance\n                    .registry\n                    .getLocalProfiles()\n                    .then((list: [string[]]) => {\n                        this.fireEvent(\n                            channels.client[this.MODULE_NAME].getLocalIdentities,\n                            mainResponse(list)\n                        );\n                    })\n                    .catch((err: Error) => {\n                        this.fireEvent(\n                            channels.client[this.MODULE_NAME].getLocalIdentities,\n                            mainResponse({error: {message: err.message}})\n                        );\n                    });\n            }\n        );\n        return this;\n    }\n}\n\nexport default AuthIPC;\n"]}
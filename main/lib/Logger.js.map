{"version":3,"file":"Logger.js","sourceRoot":"","sources":["Logger.ts"],"names":[],"mappings":";AAAA,uBAAiC,MAAM,CAAC,CAAA;AACxC,0BAAmC,SAAS,CAAC,CAAA;AAC7C,qBAAgD,IAAI,CAAC,CAAA;AAErD,MAAM,cAAc,GAAG,MAAM,EAAE,CAAC;AAChC,MAAM,MAAM,GAAG,MAAM,EAAE,CAAC;AAExB;IAUI,YAAY,QAAgB,EAAE,QAAgB;QAC1C,EAAE,CAAC,CAAC,QAAQ,KAAK,cAAc,CAAC,CAAC,CAAC;YAC9B,MAAM,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC;QAClD,CAAC;QAED,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACZ,QAAQ,GAAG,OAAO,CAAC,GAAG,EAAE,CAAC;QAC7B,CAAC;QACD,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;QAClB,MAAM,WAAW,GAAG,WAAQ,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QAC/C,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;IACrC,CAAC;IAOD,OAAO,WAAW,CAAC,QAAgB;QAC/B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YAChB,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,SAAS,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAC;QAC3D,CAAC;QACD,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IACxB,CAAC;IAOO,cAAc,CAAC,IAAY;QAC/B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,MAAM,CAAC,WAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,SAAI,EAAE,CAAC,GAAG;YACpC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;gBACN,MAAM,CAAC,UAAK,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,KAAK;oBAC7B,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;wBACR,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;oBACzB,CAAC;gBACL,CAAC,CAAC,CAAC;YACP,CAAC;YACD,MAAM,CAAC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QAC/B,CAAC,CAAC,CAAC;IACP,CAAC;IAWD,cAAc,CAAC,IAAY,EAAE,EACzB,KAAK,GAAG,MAAM,EACd,YAAY,GAAG,MAAM,EACrB,OAAO,GAAG,EAAE,GAAG,IAAI,EACnB,QAAQ,GAAG,CAAC,EACf,GAAG,EAAE;QACF,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;YAChB,MAAM,IAAI,KAAK,CAAC,GAAG,IAAI,CAAC,OAAO,oBAAoB,CAAC,CAAC;QACzD,CAAC;QACD,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,gBAAM,CAAC,CAAC;YAC9B,UAAU,EAAE;gBACR,IAAI,oBAAU,CAAC,OAAO,CAAC;oBACnB,KAAK,EAAE,YAAY;oBACnB,QAAQ,EAAE,IAAI;iBACjB,CAAC;gBACF,IAAI,CAAC,oBAAU,CAAC,IAAI,CAAC,CAAC;oBAClB,QAAQ,EAAE,WAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,IAAI,MAAM,CAAC;oBAC/C,OAAA,KAAK;oBACL,SAAA,OAAO;oBACP,UAAA,QAAQ;oBACR,IAAI,EAAE,OAAO,IAAI,EAAE;iBACtB,CAAC;aACL;SACJ,CAAC,CAAC;QACH,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IAC9B,CAAC;IAOD,SAAS,CAAC,IAAY;QAClB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IAC9B,CAAC;AACL,CAAC;AAED;kBAAe,SAAS,CAAC","sourcesContent":["import { join as pathJoin } from 'path';\nimport { Logger, transports } from 'winston';\nimport { W_OK, access as fsAccess, mkdir } from 'fs';\n\nconst symbolEnforcer = Symbol();\nconst symbol = Symbol();\n\nclass AppLogger {\n    public logPath: string;\n    public loggers: Object;\n    public PATH_OK: boolean;\n\n    /**\n     *\n     * @param userData      Folder target for logs\n     * @param enforcer\n     */\n    constructor(userData: string, enforcer: Symbol) {\n        if (enforcer !== symbolEnforcer) {\n            throw new Error('Cannot construct singleton');\n        }\n\n        if (!userData) {\n            userData = process.cwd();\n        }\n        this.loggers = {};\n        const defaultPath = pathJoin(userData, 'logs');\n        this._setLogsFolder(defaultPath);\n    }\n\n    /**\n     *\n     * @param userData\n     * @returns {*}\n     */\n    static getInstance(userData: string) {\n        if (!this[symbol]) {\n            this[symbol] = new AppLogger(userData, symbolEnforcer);\n        }\n        return this[symbol];\n    }\n\n    /**\n     *\n     * @param path\n     * @private\n     */\n    private _setLogsFolder(path: string) {\n        this.logPath = path;\n        return fsAccess(this.logPath, W_OK, (err) => {\n            if (err) {\n                return mkdir(this.logPath, (error) => {\n                    if (error) {\n                        this.PATH_OK = false;\n                    }\n                });\n            }\n            return this.PATH_OK = true;\n        });\n    }\n\n    /**\n     *\n     * @param name\n     * @param level\n     * @param consoleLevel\n     * @param maxsize\n     * @param maxFiles\n     * @returns {any}\n     */\n    registerLogger(name: string, {\n        level = 'info',\n        consoleLevel = 'warn',\n        maxsize = 10 * 1024,\n        maxFiles = 1\n    } = {}) {\n        if (!this.PATH_OK) {\n            throw new Error(`${this.logPath} is not accessible`);\n        }\n        this.loggers[name] = new (Logger)({\n            transports: [\n                new transports.Console({\n                    level: consoleLevel,\n                    colorize: true\n                }),\n                new (transports.File)({\n                    filename: pathJoin(this.logPath, `${name}.log`),\n                    level,\n                    maxsize,\n                    maxFiles,\n                    name: `log-${name}`\n                })\n            ]\n        });\n        return this.loggers[name];\n    }\n\n    /**\n     *\n     * @param name\n     * @returns {*}\n     */\n    getLogger(name: string) {\n        return this.loggers[name];\n    }\n}\n\nexport default AppLogger;\n"]}